; -----------------------------------------------------------------------------
; PlatformIO Project Configuration File
;
; This file defines the project structure, board types, frameworks,
; and library dependencies for both ESP32 microcontrollers. It creates two
; separate build environments: one for ESP1 and one for ESP2.
;
; Concepts are derived from the project document "Integriertes Dual-ESP32-Steuerungssystem".
[cite_start]; [cite: 173-210, 509-559]
; -----------------------------------------------------------------------------

[platformio]
; Define the default environments to build when "pio run" is used without a target.
default_envs = esp1, esp2
description = Dual ESP32 control system for LinuxCNC via EtherCAT and ESP-NOW.

; -----------------------------------------------------------------------------
; COMMON CONFIGURATION FOR BOTH ENVIRONMENTS
; -----------------------------------------------------------------------------
[env]
framework = arduino
platform = espressif32
board = esp32dev
monitor_speed = 115200
lib_ldf_mode = chain+ ; Recommended library dependency finder mode.
;extra_scripts = extra_script.py ; <-- ADD THIS LINE

; -----------------------------------------------------------------------------
; ENVIRONMENT FOR ESP1 (EtherCAT REAL-TIME BRIDGE)
; -----------------------------------------------------------------------------
[env:esp1]
; Source code for this environment is located in the src/esp1/ directory.
build_src_filter = 
  +<esp1/**>
  -<esp2/**>
lib_deps =
    madhephaestus/ESP32Encoder@^0.11.7
build_flags = -DCORE_ESP1
;extra_scripts = pre:scripts/generate_mapping.py

; -----------------------------------------------------------------------------
; ENVIRONMENT FOR ESP2 (HMI CONTROLLER & WEB INTERFACE)
; -----------------------------------------------------------------------------
[env:esp2]
; Source code for this environment is located in the src/esp2/ directory.
build_src_filter =
  +<esp2/**>
  -<esp1/**>

; Instruct PlatformIO to build a LittleFS filesystem image from the /data directory.
board_build.filesystem = littlefs

; Library dependencies for ESP2.
lib_deps =
    madhephaestus/ESP32Encoder@^0.11.7
    adafruit/Adafruit MCP23017 Arduino Library@^2.3.2
    me-no-dev/ESPAsyncWebServer
    AsyncTCP
    ;ayushsharma82/AsyncElegantOTA@^2.2.7 --> doesn't work; the following line does work -->
    https://github.com/ayushsharma82/AsyncElegantOTA.git#v2.2.7
    bblanchon/ArduinoJson@^6.21.4

; Custom build flags for this environment.
build_flags = -DCORE_ESP2